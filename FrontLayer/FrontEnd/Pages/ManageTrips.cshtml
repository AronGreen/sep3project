@page
@model FrontEnd.Pages.ManageTripsModel
@using FrontEnd.Pages.Entities;
@{
    ViewData["Title"] = "ManageTrips";
}

@section header{ 

    <partial name="_HeaderItems" />

}

<link rel="stylesheet" href="~/css/popup.css" />


<form method="get">
    <button type="submit" asp-page="./MainLoggedIn" class="mb-3">Go to main</button>
</form>


<h1 align="center">ManageTrips</h1>


<div>

    <div class="box">
        <a class="button" href="#createTripPopup">Create a trip</a>
    </div>

    <div id="createTripPopup" class="overlay">
        <div class="popup">
            <h2>Create a trip</h2>
            <a class="close" href="#">&times;</a>
            <div class="content">

                <div align="center">

                    <form method="post" class="text-center">


                        <span class="input">
                            <input type="text" name="Description" placeholder="Title" /><br />
                        </span>

                        <span class="input">
                            <input type="text" name="Date" placeholder="Date" /><br />
                        </span>

                        <span class="input">
                            <input type="text" name="StartingPoint" placeholder="Starting Point" /><br />
                        </span>

                        <span class="input">
                            <input type="text" name="EndingPoint" placeholder="Ending Point" /><br />
                        </span>

                        <br />
                        <label for="AvailableSeats">Available seats:</label>

                        <select asp-for="AvailableSeats" asp-items="Model.Seats">
                            <option value=""></option>
                        </select>

                        <button asp-page-handler="send" class="mb-3">Create Trip</button>
                    </form>


                </div>
            </div>
        </div>
    </div>



    <form method="post" class="text-center">
        <button asp-page-handler="trip" class="mb-3">Update available trips</button>
    </form>

    ()


    <div>


        <table width="60%" align="center" id="table-trips">
            <tr>
                <td>Title</td>
                <td>Date</td>
                <td>Start</td>
                <td>End</td>
                <td>Available Seats</td>
                <td>Driver</td>
                <td>&nbsp;</td>
            </tr>

            @if (Model.trips.Count > 0)
                @foreach (Trip t in Model.trips)
                {

                    <tr>
                        <td>@t.Description</td>
                        <td>@t.Arrival</td>
                        <td>@t.StartAddress</td>
                        <td>@t.DestinationAddress</td>
                        <td>@t.TotalSeats</td>
                        <td><a href="">@t.DriverEmail</a></td>
                        <td>
                            @if (t.TotalSeats < 1)
                            {
                                <p style="color: darkred; text-decoration:solid;">No available space - sorry!</p>
                            }
                            else
                            {
                                <div style="min-height:45px; margin-top: 5px;">
                                    <a class="button" href="#@t.Id">Reserve</a>
                                </div>

                            }



                        </td>
                    </tr>

                    <tr>
                        <td>
                        <div id="@t.Id" class="overlay">
                            <div class="popup">
                                <h2>Reservation for trip by : @t.DriverEmail</h2>
                                <a class="close" href="#">&times;</a>
                                <div class="content">

                                    <div align="center">


                                        <form method="post" class="text-center">

                                            <input name="TripID" value="@t.Id" disabled />
                                            <br />
                                            <span class="input">
                                                <input type="text" name="PickUpPoint" placeholder="Where to pick you up?" /><br />
                                            </span>
                                            <br />

                                            <label>When do you want to be picked up?</label>
                                            <span class="input">
                                                <input type="time" name="PickUpTime" placeholder="When to pick you up?" /><br />
                                            </span>
                                            <br />
                                            <span class="input">
                                                <input type="text" name="DropOffPoint" placeholder="Where to drop you off?" /><br />
                                            </span>
                                            <br />




                                            <label for="Date">How many seats?</label>
                                            <select name="ReservedSeats" asp-for="ReservedSeats">
                                                @for (int i = 1; i <= t.TotalSeats; i -= -1)
                                                {
                                                    <option value="@i">@i</option>
                                                }
                                            </select>



                                            <button asp-page-handler="reservation" class="mb-3">Reserve</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </td>
                    </tr>
                }

            else
            {
                <tr>
                    <td rowspan="7">No trips available right now!</td>
                </tr>
            }




        </table>
    </div>


</div>

<p></p>








